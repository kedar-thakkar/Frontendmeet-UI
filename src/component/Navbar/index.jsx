import React, { useEffect, useState } from "react";
import { useNavigate } from "react-router-dom";
import './Navbar.css';
import Logo from "../../assets/img/front logo dark.svg";
import profilePic from "../../assets/img/default-avatar-profile-icon-vector-social-media-user-portrait-176256935.jpg";
import arrow from "../../assets/img/select_arrow.svg";
import emailmsg from "../../assets/img/message_icon.svg";
import Profile from "../Profile";
import { Link } from "react-router-dom";
import { getProfileHandler } from "../../service/auth.services";
import { ENDPOINTURL } from "../../utils/EndPoint";
import { getUserData, EventEmitter } from "../../utils/helper";


function Navbar(props) {
    const [userName, setUserName] = useState('');
    const [userEmail, setUserEmail] = useState('');
    const [profilePicture, setProfilePicture] = useState(getUserData().profilePic);
    const [avtar,setAvtar]=useState(profilePic);
    const logoutHandler = () => {
        localStorage.clear();
    }
    let userId = ""
    // for the profile picture 
    EventEmitter.subscribe('updateProfilePic',res => {
        setProfilePicture(res);
    })

    // for the user name
    EventEmitter.subscribe('username',res=>{
        setUserName(res);
    })

    useEffect(async () => {
        // get data from local storage 
        const GetData= getUserData();
        // console.log(GetData);
        var userId = localStorage.getItem('userId');
        if(GetData){
            setUserName(GetData.name);
            setUserEmail(GetData.email);
            props.username(GetData.name);
            props.userEmailId(GetData.email);
        }
    }, [userId])

    return (
        <>
            <Profile userName={userName} userEmail={userEmail} UserPicture={profilePicture} />
            <header className="header">
                <div className="wrapper">
                    <div className="header_inr">
                        <div className="header_logo">
                            <Link to="/dashboard">
                                <img src={Logo} alt="" />
                            </Link>
                        </div>
                        <div className="header_right">
                            <div className="profile_box_head">
                                <a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#profile_popup" className="profile_toggle">
                                    <div className="header_profile">
                                        <div className="header_profile_pic">
                                            <img src={profilePicture ? profilePicture :avtar} alt="" />
                                            {/* <img src="https://res.cloudinary.com/hp4ph7gey/image/upload/v1/user_profile/6.png"/> */}
                                        </div>
                                        <div className="header_profile_name">
                                            <p>{userName}</p>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <div className="login_box">
                                {/* <h4>Log Out</h4> */}
                                <Link to="/" onClick={logoutHandler}>
                                    <svg width="27" height="20" viewBox="0 0 27 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path opacity="0.2" fillRule="evenodd" clipRule="evenodd" d="M11.0786 0.0303946C11.2961 0.0570718 11.7232 0.129195 12.0276 0.190721C12.3321 0.252195 12.8303 0.383894 13.1348 0.483327C13.4393 0.582813 14.0442 0.841782 14.4792 1.05884C14.9142 1.27584 15.4791 1.60366 15.7347 1.78729C15.9902 1.97087 16.3995 2.29685 16.6442 2.51158C16.8888 2.72637 17.2668 3.10565 17.4841 3.35444C17.7014 3.60329 17.9752 3.94082 18.0924 4.10452C18.2097 4.26827 18.3516 4.50362 18.4079 4.62752C18.4641 4.75141 18.5101 4.95956 18.5101 5.09004C18.5101 5.22053 18.4617 5.43405 18.4025 5.56454C18.3434 5.69502 18.2431 5.85746 18.1796 5.92552C18.1162 5.99359 17.9801 6.09244 17.8773 6.14521C17.7745 6.19794 17.6031 6.25746 17.4965 6.27749C17.3897 6.29753 17.1857 6.28577 17.0423 6.25134C16.899 6.21702 16.7105 6.13625 16.6233 6.07193C16.5361 6.00766 16.2919 5.73072 16.0805 5.45662C15.8691 5.18252 15.5279 4.79164 15.3222 4.58803C15.1165 4.38442 14.7861 4.0964 14.5879 3.94793C14.3897 3.79952 14.0388 3.56581 13.8082 3.42862C13.5775 3.29144 13.1622 3.08662 12.8852 2.97348C12.6082 2.86034 12.2011 2.71994 11.9806 2.66152C11.76 2.60306 11.3541 2.5207 11.0786 2.47853C10.8032 2.43635 10.3168 2.40213 9.99785 2.4025C9.67889 2.40282 9.20439 2.43593 8.94342 2.47605C8.68245 2.51617 8.27913 2.59831 8.04715 2.65852C7.81517 2.71873 7.49489 2.81779 7.33541 2.87858C7.17592 2.93942 6.83191 3.09432 6.57094 3.22285C6.30997 3.35139 5.87206 3.61652 5.59781 3.81202C5.32355 4.00746 4.88464 4.3831 4.62245 4.64676C4.36027 4.91037 4.00904 5.31675 3.84202 5.54978C3.67494 5.78281 3.42135 6.19577 3.27847 6.46756C3.1356 6.73934 2.94912 7.15146 2.86413 7.38344C2.77915 7.61541 2.65989 8.01873 2.59905 8.27971C2.53826 8.54068 2.46266 9.03294 2.43108 9.37368C2.38964 9.82055 2.38964 10.1658 2.43108 10.6126C2.46266 10.9533 2.53826 11.4456 2.59905 11.7066C2.65989 11.9676 2.77915 12.3709 2.86413 12.6029C2.94912 12.8349 3.1356 13.247 3.27847 13.5188C3.42135 13.7905 3.67494 14.2035 3.84202 14.4365C4.00904 14.6696 4.36027 15.076 4.62245 15.3396C4.88464 15.6032 5.32355 15.9789 5.59781 16.1743C5.87206 16.3698 6.30997 16.6349 6.57094 16.7635C6.83191 16.892 7.17592 17.0469 7.33541 17.1077C7.49489 17.1685 7.81517 17.2676 8.04715 17.3278C8.27913 17.388 8.68245 17.4701 8.94342 17.5103C9.20439 17.5504 9.67889 17.5835 9.99785 17.5838C10.3168 17.5842 10.8032 17.55 11.0786 17.5078C11.3541 17.4656 11.76 17.3833 11.9806 17.3248C12.2011 17.2664 12.6082 17.126 12.8852 17.0128C13.1622 16.8997 13.5775 16.6949 13.8082 16.5577C14.0388 16.4205 14.3897 16.1868 14.5879 16.0384C14.7861 15.8899 15.1162 15.6019 15.3215 15.3983C15.5268 15.1947 15.8597 14.8146 16.0614 14.5536C16.263 14.2926 16.4641 14.0481 16.508 14.0103C16.5521 13.9724 16.683 13.8959 16.799 13.8401C16.9283 13.7779 17.1219 13.7387 17.2998 13.7387C17.469 13.7387 17.6789 13.7792 17.8036 13.8358C17.9212 13.8892 18.1026 14.0325 18.2067 14.1541C18.3108 14.2757 18.4222 14.4792 18.4542 14.6064C18.4862 14.7335 18.5122 14.8804 18.5121 14.9328C18.5119 14.9852 18.4872 15.1167 18.4571 15.225C18.427 15.3333 18.2908 15.5858 18.1543 15.786C18.0178 15.9862 17.7223 16.3602 17.4976 16.6171C17.2729 16.874 16.8888 17.2599 16.6442 17.4747C16.3995 17.6895 15.9902 18.0154 15.7347 18.199C15.4791 18.3827 14.9142 18.7105 14.4792 18.9275C14.0442 19.1445 13.4393 19.4034 13.1348 19.5027C12.8303 19.6021 12.344 19.7319 12.054 19.7912C11.764 19.8505 11.2658 19.9271 10.9468 19.9614C10.5888 19.9999 10.0845 20.0105 9.6288 19.9891C9.22284 19.9701 8.68904 19.9217 8.44256 19.8814C8.19609 19.8413 7.75407 19.7473 7.4603 19.6728C7.16659 19.5982 6.71408 19.4562 6.4548 19.3573C6.19556 19.2583 5.78491 19.0776 5.54234 18.9556C5.29977 18.8336 4.91664 18.6193 4.69099 18.4793C4.46535 18.3394 4.09608 18.0843 3.87054 17.9124C3.64494 17.7406 3.2277 17.3683 2.94337 17.0852C2.65905 16.8021 2.25478 16.3421 2.045 16.0629C1.83516 15.7837 1.55073 15.3724 1.41281 15.1488C1.27494 14.9252 1.0697 14.5451 0.956768 14.3042C0.843891 14.0632 0.678873 13.6692 0.590195 13.4287C0.501463 13.1881 0.370241 12.7598 0.298538 12.4769C0.226837 12.1941 0.130356 11.7153 0.0841198 11.4129C0.0327682 11.0771 2.86102e-05 10.5244 2.86102e-05 9.99316C2.86102e-05 9.46194 0.0327682 8.9092 0.0841198 8.57347C0.130356 8.27106 0.226837 7.79224 0.298538 7.50939C0.370241 7.22654 0.501463 6.79823 0.590195 6.55766C0.678873 6.31709 0.843891 5.9231 0.956768 5.68211C1.0697 5.44117 1.27494 5.0611 1.41281 4.83751C1.55073 4.61397 1.83516 4.20258 2.045 3.92342C2.25478 3.64426 2.65905 3.18421 2.94337 2.90109C3.2277 2.61798 3.64494 2.24576 3.87054 2.07389C4.09608 1.90207 4.46535 1.64695 4.69099 1.50697C4.91664 1.367 5.29977 1.15268 5.54234 1.03074C5.78491 0.908738 6.19556 0.728008 6.4548 0.62905C6.71408 0.530144 7.16659 0.388164 7.4603 0.313563C7.75407 0.239014 8.19609 0.144432 8.44256 0.103414C8.68904 0.0623968 9.29402 0.0182687 9.78697 0.00535186C10.2799 -0.00756496 10.8612 0.0037174 11.0786 0.0303946ZM22.3674 5.1628C22.5013 5.19886 22.7029 5.30219 22.8155 5.3924C22.928 5.48261 23.8653 6.4064 24.8984 7.44528C26.4006 8.95591 26.7904 9.37637 26.8452 9.54503C26.883 9.66101 26.9138 9.86267 26.9138 9.99316C26.9138 10.1236 26.883 10.3253 26.8452 10.4413C26.7904 10.6097 26.4037 11.0276 24.9247 12.5165C23.9062 13.5418 22.9601 14.4713 22.8224 14.5821C22.6536 14.7177 22.4796 14.8025 22.2885 14.8422C22.0765 14.8862 21.9433 14.8855 21.7602 14.8394C21.6255 14.8055 21.4241 14.7117 21.3127 14.631C21.1938 14.5449 21.0525 14.3688 20.9711 14.2054C20.8817 14.0259 20.8323 13.8411 20.8327 13.6865C20.833 13.5433 20.8839 13.3401 20.9589 13.1828C21.0481 12.9959 21.3241 12.6816 21.9074 12.1027C22.3599 11.6536 22.7301 11.2683 22.7301 11.2467C22.7301 11.2249 19.4621 11.201 15.4677 11.1933L8.20531 11.1794L7.99443 11.0659C7.87844 11.0035 7.73161 10.8967 7.66819 10.8286C7.60476 10.7606 7.50443 10.5981 7.44528 10.4677C7.38613 10.3372 7.33773 10.1236 7.33773 9.99316C7.33773 9.86267 7.38613 9.64915 7.44528 9.51867C7.50443 9.38818 7.60476 9.22574 7.66819 9.15768C7.73161 9.08962 7.87844 8.98285 7.99443 8.92043L8.20531 8.80692L15.4677 8.793C19.4621 8.78536 22.7301 8.76137 22.7301 8.73965C22.7301 8.71798 22.3599 8.33274 21.9074 7.88366C21.3241 7.30467 21.0481 6.9904 20.9589 6.8035C20.8839 6.64623 20.833 6.44304 20.8327 6.29979C20.8324 6.14601 20.8815 5.96074 20.9694 5.78428C21.0449 5.63281 21.1862 5.44823 21.2834 5.37411C21.3806 5.29998 21.5717 5.20571 21.7081 5.1647C21.8445 5.12363 21.9938 5.09162 22.04 5.09358C22.0861 5.09558 22.2334 5.12668 22.3674 5.1628Z" fill="black" />
                                    </svg>
                                </Link>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
        </>
    )
}

export default Navbar;